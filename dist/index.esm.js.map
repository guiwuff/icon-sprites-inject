{"version":3,"file":"index.esm.js","sources":["../src/sprite-injector.ts"],"sourcesContent":["// This will automatically inject the SVG symbol defs\n// to be use via <use>\n\n\nfunction injectSprites(document: HTMLDocument) {\n  const CREATE_ELEMENT = 'createElement';\n  const A_ELEMENT = document[CREATE_ELEMENT]('a');\n  const DIV_ELEMENT = document[CREATE_ELEMENT]('div');\n\n  function load(path: string, callback, errorCallback) {\n    if (path) {\n      const req = new XMLHttpRequest();\n      req.onreadystatechange = function() {\n        if (req.readyState == 4 &&\n          req.status == 200) {\n            callback(req.responseText);\n          }\n      }\n      req.onerror = errorCallback;\n      req.open('GET', path, true);\n      req.send();\n    }\n  }\n\n  function buildSvgSprite(svgSpriteStr: string, absUrl: string) {\n    DIV_ELEMENT.innerHTML = svgSpriteStr;\n    const svg = DIV_ELEMENT.removeChild(DIV_ELEMENT.firstChild).cloneNode(true);\n    svg['style'] = 'display:none';\n    svg['data-inject-url'] = absUrl;\n    return svg;\n  }\n\n  function getAbsoluteUrl(url): string {\n    A_ELEMENT.href = url;\n    return A_ELEMENT.href;\n  }\n\n  function applyAllOptions(optionKey, optionsArr, func) {\n    for (let i = 0; i < optionsArr.length; ++i) {\n      const options = optionsArr[i];\n      if (options.hasOwnProperty(optionKey)){\n        func(options[optionKey]);\n      }\n    }\n  }\n\n  // const spriteHandlerMap = {};\n  const cachedMap = {};\n\n  function SVGSpriteInject(path: string, options) {\n    options = options || {};\n    const absUrl = getAbsoluteUrl(path);\n    let cached = cachedMap[absUrl];\n\n    if (cached) {\n      const svgSprite = cached.svgSprite;\n      if (svgSprite) {\n        if (options.onInjected) {\n          options.onInjected(svgSprite);\n        }\n      } else {\n        cached.optionsArr.push(options);\n      }\n    } else {\n      let removed = false;\n\n      cachedMap[absUrl] = cached = {\n        spriteHandler: {\n          remove: function() {\n            if (!removed) {\n              let cachedSvgSprite = cached.svgSprite;\n              if (cachedSvgSprite) {\n                const parentNode = cachedSvgSprite.parentNode;\n                parentNode && parentNode.removeChild(cachedSvgSprite);\n                cached.svgSprite = null;\n              }\n              delete cachedMap[absUrl];\n              removed = true;\n            }\n          }\n        },\n        svgSprite: null,\n        optionsArr: [options]\n      };\n\n      load(path, function(svgSpriteStr) {\n        let svgSprite = buildSvgSprite(svgSpriteStr, absUrl);\n        if (!removed) {\n          cached.svgSprite = svgSprite;\n          document.documentElement.appendChild(svgSprite);\n          applyAllOptions('afterInject', cached.optionsArr, function (afterInject) {\n            afterInject(svgSprite);\n          });\n        }\n      }, function(e) {\n        applyAllOptions('onLoadFail', cached.optionsArr, function(onLoadFail) {\n          onLoadFail(e);\n        });\n      });\n    }\n    return cached.spriteHandler;\n  };\n\n  return SVGSpriteInject;\n}\n\nconst SVGSpriteInject = injectSprites(document);\n\nexport const spriteInject = (path: string, options = {}) => {\n  SVGSpriteInject(path, options);\n}\n"],"names":[],"mappings":"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"}